check_tool() {
  local name="$1"
  local bin="$2"

  if command -v "$bin" >/dev/null 2>&1; then
    echo "[+] $name ($bin) found."
    return 0
  fi

  echo "[-] $name ($bin) not found. Attempting to install..."

  if command -v apt-get >/dev/null 2>&1; then
    if [[ "$bin" == "maldet" ]]; then
      cd /usr/local/src || exit 1
      wget -q http://www.rfxn.com/downloads/maldetect-current.tar.gz
      tar -xzf maldetect-current.tar.gz
      cd maldetect-* || exit 1
      ./install.sh
    elif [[ "$bin" == "clamscan" ]]; then
      apt-get update -y
      apt-get install -y clamav clamav-daemon
    fi
  else
    echo "[-] Cannot auto-install $name (unsupported OS / package manager)."
    return 1
  fi

  if command -v "$bin" >/dev/null 2>&1; then
    echo "[+] $name installed successfully."
    return 0
  else
    echo "[-] $name still missing after attempted install."
    return 1
  fi
}

echo "[+] Checking required tools (Maldet, ClamAV)..."
check_tool "Maldet" "maldet" || { echo "[-] Maldet missing; aborting."; exit 1; }
check_tool "ClamAV" "clamscan" || { echo "[-] ClamAV missing; aborting."; exit 1; }
